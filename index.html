<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>砖拽 砖注转 驻住转</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- No-JS fallback -->
    <noscript>
        <style>
            #js-disabled-message {
                display: block !important;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(42, 100, 150, 0.95);
                color: white;
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
                text-align: center;
                padding: 20px;
            }
        </style>
    </noscript>
</head>
<body>
    <!-- Message for browsers with JavaScript disabled -->
    <div id="js-disabled-message" style="display: none;">
        <div>
            <h2>JavaScript 专砖 注专 砖拽 </h2>
            <p>专 砖-JavaScript 砖转 驻驻 砖.  驻注 JavaScript  砖拽 砖拽 砖注转 驻住转.</p>
        </div>
    </div>

    <!-- Loading screen -->
    <div id="loading-screen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(42, 100, 150, 0.9); color: white; display: flex; justify-content: center; align-items: center; z-index: 1500;">
        <div style="text-align: center;">
            <h2>注 砖拽...</h2>
            <div style="width: 200px; height: 10px; background-color: rgba(255,255,255,0.3); border-radius: 5px; margin: 20px auto;">
                <div id="loading-bar" style="width: 0%; height: 100%; background-color: white; border-radius: 5px; transition: width 0.3s;"></div>
            </div>
        </div>
    </div>

    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        
        <!-- Day/Night cycle overlay -->
        <div id="day-night-overlay"></div>
        
        <!-- Sun and Moon -->
        <div id="sun"></div>
        <div id="moon"></div>
        
        <div id="score-display" class="game-display">住 住 驻住: 0 砖"</div>
        <div id="date-display" class="game-display">专抓 2025</div>
        
        <div id="monthly-stats">
            <div>爪转 砖转: <span id="expenses">0</span> 砖"</div>
            <div>住 砖转: <span id="income">5,000</span> 砖"</div>
        </div>
        
        <div class="health-bars">
            <div class="health-bar">
                <div class="label">专转 驻转</div>
                <div class="bar">
                    <div id="physical-health-fill" class="fill" style="width: 90%;"></div>
                </div>
            </div>
            <div class="health-bar">
                <div class="label">专转 转</div>
                <div class="bar">
                    <div id="mental-health-fill" class="fill" style="width: 90%;"></div>
                </div>
            </div>
            <div class="day-clock-container">
                <div class="label">砖注  <span class="clock-icon"></span></div>
                <div id="day-clock">05:00</div>
            </div>
        </div>
        
        <div id="power-meter" class="power-meter">
            <div id="power-meter-fill" class="power-meter-fill"></div>
        </div>
        
        <div id="popup-message" class="popup-message"></div>
        <div id="finance-tip" class="finance-tip"></div>
        
        <div id="status-negative" class="status-effect">砖驻注 转: 砖</div>
        <div id="status-weight" class="status-effect">爪 驻: </div>
        <div id="speed-indicator">专转: 专</div>
        <div id="movement-instruction">抓 注 住  转拽!<br><span style="font-size: 32px; font-weight: normal; opacity: 0.9;"> 爪  转拽转</span></div>
        
        <!--  驻专-驻 -->
        <div id="powerup-dialog" class="dialog-box">
            <h3 id="powerup-title">转拽转 转 砖驻专!</h3>
            <p id="powerup-text"> 注砖转  专 ?</p>
            <button id="powerup-yes-btn"></button>
            <button id="powerup-no-btn"></button>
        </div>
        
        <!--  砖 -->
        <div id="obstacle-dialog" class="dialog-box">
            <h3 id="obstacle-title">转转 注  驻住转</h3>
            <p id="obstacle-text"> 专 爪 转  砖 转转 住?</p>
            <button id="ignore-btn">住专</button>
            <button id="accept-btn">住</button>
        </div>
        
        <div id="welcome-screen">
            <div id="welcome-content">
                <h1>专  砖拽 砖注转 驻住转</h1>
                <p>专 砖  爪专 100,000 砖" 爪注转 转 转 驻住转 转.</p>
                <p>抓 注 住 ( 拽 拽砖 专)  转拽 专 驻住转. 转拽转 专砖转 抓 转.</p>
                <p>转 专 5,000 砖" 砖 注 爪 砖,  转转拽 转 驻转 专 专.</p>
                <p>拽爪 转拽转 砖 砖驻注 爪 驻 .</p>
                <p>专 - 爪转 驻住转  专转,  住驻专. 专砖转 砖注转 转 专 .</p>
                <button id="start-btn">转</button>
            </div>
        </div>
        
        <div id="game-over">
            <h2> 驻住 砖</h2>
            <p id="game-over-reason"></p>
            <p>爪专转 住 砖 <span id="final-score">0</span> 砖" 住 驻住</p>
            <div id="game-stats">
                <p>转拽驻 砖: <span id="months-played">0</span> 砖</p>
                <p>专 驻住 : <span id="powerups-collected">0</span></p>
                <p>转 驻住转 砖驻转专: <span id="obstacles-avoided">0</span></p>
            </div>
            <p class="lesson">拽: 爪转 驻住转 专砖转 砖注转, 转 专  转 砖转.</p>
            <button id="restart-btn">住 砖</button>
        </div>
        
        <div id="win-screen">
            <h2>爪转 驻住转 砖!</h2>
            <p>爪转 爪专 100,000 砖" 住 驻住!</p>
            <p>  注 砖注转 注爪转, 转 拽转 转 转.</p>
            <div id="win-stats">
                <p>转拽驻转 爪专转 住: <span id="win-months">0</span> 砖</p>
                <p>专 驻住 : <span id="win-powerups">0</span></p>
                <p>转 驻住转 砖驻转专: <span id="win-obstacles">0</span></p>
            </div>
            <p class="lesson">专: 爪转 驻住转  转 转砖 专砖 转 转 砖转.</p>
            <button id="play-again-btn">住 住祝</button>
        </div>
    </div>
    
    <script>
        // Simple module/script loading system with error handling
        window.gameModules = {
            loaded: {},
            ready: false,
            loadScript: function(src, callback) {
                const script = document.createElement('script');
                script.src = src;
                script.async = false; // Keep script execution order
                
                script.onload = function() {
                    window.gameModules.loaded[src] = true;
                    if (callback) callback(null);
                    
                    // Update loading bar
                    const moduleCount = 3; // Total number of modules to load
                    const loadedCount = Object.keys(window.gameModules.loaded).length;
                    const loadingBar = document.getElementById('loading-bar');
                    if (loadingBar) {
                        loadingBar.style.width = (loadedCount / moduleCount * 100) + '%';
                    }
                    
                    // If all modules are loaded, initialize the game
                    if (loadedCount === moduleCount) {
                        window.gameModules.ready = true;
                        
                        // Hide loading screen after a small delay
                        setTimeout(function() {
                            const loadingScreen = document.getElementById('loading-screen');
                            if (loadingScreen) {
                                loadingScreen.style.opacity = '0';
                                loadingScreen.style.transition = 'opacity 0.5s ease';
                                setTimeout(function() {
                                    loadingScreen.style.display = 'none';
                                }, 500);
                            }
                        }, 300);
                    }
                };
                
                script.onerror = function(err) {
                    console.error('Failed to load script: ' + src);
                    if (callback) callback(new Error('Failed to load ' + src));
                    
                    // Show error message
                    alert('砖 注转 砖拽.  专注 转 祝 住转 砖.');
                };
                
                document.body.appendChild(script);
            }
        };
        
        // Load scripts in the correct order
        document.addEventListener('DOMContentLoaded', function() {
            // Hide the noscript message since JS is obviously working
            document.getElementById('js-disabled-message').style.display = 'none';
            
            // Load scripts in sequence with dependencies first
            window.gameModules.loadScript('obstacles.js', function(err) {
                if (!err) {
                    window.gameModules.loadScript('visual-effects.js', function(err) {
                        if (!err) {
                            window.gameModules.loadScript('game.js', function(err) {
                                if (err) {
                                    console.error('Game initialization failed');
                                }
                            });
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>
